# Test info

- Name: Note Management >> should create a new note in root
- Location: /Users/ncls/work/perso/notes/e2e/notes.spec.ts:29:3

# Error details

```
Error: page.waitForSelector: Target page, context or browser has been closed
Call log:
  - waiting for locator('[data-testid="new-note-button"]') to be visible

    at /Users/ncls/work/perso/notes/e2e/notes.spec.ts:47:16
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 |
   3 | test.describe('Note Management', () => {
   4 |   test.beforeEach(async ({ page }) => {
   5 |     // Register and login a test user
   6 |     await page.goto('/register');
   7 |
   8 |     const timestamp = Date.now();
   9 |     const testEmail = `note-test-${timestamp}@example.com`;
   10 |     const testPassword = 'TestPassword123!';
   11 |
   12 |     await page.fill('input[name="email"]', testEmail);
   13 |     await page.fill('input[name="password"]', testPassword);
   14 |     await page.fill('input[name="confirmPassword"]', testPassword);
   15 |     await page.click('button[type="submit"]');
   16 |
   17 |     // Should redirect to login with success message
   18 |     await expect(page).toHaveURL(new RegExp('/login\\?message=registration-success'));
   19 |
   20 |     // Login
   21 |     await page.fill('input[name="email"]', testEmail);
   22 |     await page.fill('input[name="password"]', testPassword);
   23 |     await page.click('button[type="submit"]');
   24 |
   25 |     // Should redirect to dashboard
   26 |     await expect(page).toHaveURL('/dashboard');
   27 |   });
   28 |
   29 |   test('should create a new note in root', async ({ page }) => {
   30 |     // Wait for dashboard to load
   31 |     await page.waitForURL('/dashboard');
   32 |     await page.waitForLoadState('networkidle');
   33 |
   34 |     // Take a screenshot for debugging
   35 |     await page.screenshot({ path: 'debug-dashboard.png', fullPage: true });
   36 |
   37 |     // Try different selectors
   38 |     const newNoteButton = page.locator('[data-testid="new-note-button"]');
   39 |     const hasTextButton = page.locator('button:has-text("New Note")');
   40 |
   41 |     // Check what's actually on the page
   42 |     console.log('Page content:', await page.content());
   43 |     console.log('New Note button exists (testid):', await newNoteButton.isVisible());
   44 |     console.log('New Note button exists (text):', await hasTextButton.isVisible());
   45 |
   46 |     // Wait for dashboard to load and buttons to be available
>  47 |     await page.waitForSelector('[data-testid="new-note-button"]', { state: 'visible' });
      |                ^ Error: page.waitForSelector: Target page, context or browser has been closed
   48 |
   49 |     // Click "Create Note" button
   50 |     await page.click('[data-testid="new-note-button"]');
   51 |
   52 |     // Modal should be visible
   53 |     await expect(page.locator('[role="dialog"]')).toBeVisible();
   54 |     await expect(page.locator('text=Create New Note')).toBeVisible();
   55 |
   56 |     // Fill in note title
   57 |     const noteTitle = `Test Note ${Date.now()}`;
   58 |     await page.fill('input[name="title"]', noteTitle);
   59 |
   60 |     // Submit form
   61 |     await page.click('button[type="submit"]:has-text("Create")');
   62 |
   63 |     // Modal should close
   64 |     await expect(page.locator('[role="dialog"]')).not.toBeVisible();
   65 |
   66 |     // Note should appear in the dashboard
   67 |     await expect(page.locator(`text=${noteTitle}`)).toBeVisible();
   68 |
   69 |     // Should show note card
   70 |     await expect(page.locator('[data-testid="note-card"]').filter({ hasText: noteTitle })).toBeVisible();
   71 |   });
   72 |
   73 |   test('should not create note with empty title', async ({ page }) => {
   74 |     // Click "Create Note" button
   75 |     await page.click('button:has-text("New Note")');
   76 |
   77 |     // Try to submit with empty title
   78 |     await page.click('button[type="submit"]:has-text("Create")');
   79 |
   80 |     // Should show validation error
   81 |     await expect(page.locator('text=Note title is required')).toBeVisible();
   82 |
   83 |     // Modal should still be open
   84 |     await expect(page.locator('[role="dialog"]')).toBeVisible();
   85 |   });
   86 |
   87 |   test('should not create duplicate note titles in same location', async ({ page }) => {
   88 |     const noteTitle = `Duplicate Note ${Date.now()}`;
   89 |
   90 |     // Create first note
   91 |     await page.click('button:has-text("New Note")');
   92 |     await page.fill('input[name="title"]', noteTitle);
   93 |     await page.click('button[type="submit"]:has-text("Create")');
   94 |     await expect(page.locator('[role="dialog"]')).not.toBeVisible();
   95 |
   96 |     // Try to create second note with same title
   97 |     await page.click('button:has-text("New Note")');
   98 |     await page.fill('input[name="title"]', noteTitle);
   99 |     await page.click('button[type="submit"]:has-text("Create")');
  100 |
  101 |     // Should show error message
  102 |     await expect(page.locator('text=A note with this title already exists')).toBeVisible();
  103 |   });
  104 |
  105 |   test('should open note editor when clicking edit button', async ({ page }) => {
  106 |     // Create a note first
  107 |     const noteTitle = `Editor Test ${Date.now()}`;
  108 |     await page.click('button:has-text("New Note")');
  109 |     await page.fill('input[name="title"]', noteTitle);
  110 |     await page.click('button[type="submit"]:has-text("Create")');
  111 |     await expect(page.locator('[role="dialog"]')).not.toBeVisible();
  112 |
  113 |     // Find the note card and click edit button
  114 |     const noteCard = page.locator('[data-testid="note-card"]').filter({ hasText: noteTitle });
  115 |     await noteCard.locator('[data-testid="edit-note-btn"]').click();
  116 |
  117 |     // Should navigate to note editor
  118 |     await expect(page).toHaveURL(/\/notes\/[^\/]+$/);
  119 |
  120 |     // Should show note editor with CodeMirror
  121 |     await expect(page.locator('.cm-editor')).toBeVisible();
  122 |
  123 |     // Should show note title
  124 |     await expect(page.locator(`text=${noteTitle}`)).toBeVisible();
  125 |
  126 |     // Should show split view with editor and preview
  127 |     await expect(page.locator('text=Editor')).toBeVisible();
  128 |     await expect(page.locator('text=Preview')).toBeVisible();
  129 |   });
  130 |
  131 |   test('should edit and save note content', async ({ page }) => {
  132 |     // Create a note first by opening the New Note dialog
  133 |     const noteTitle = `Save Test ${Date.now()}`;
  134 |     await page.waitForSelector('button:has-text("New Note")', { state: 'visible' });
  135 |     await page.click('button:has-text("New Note")');
  136 |     await page.waitForSelector('input[name="title"]', { state: 'visible' });
  137 |     await page.fill('input[name="title"]', noteTitle);
  138 |     await page.click('button[type="submit"]:has-text("Create")');
  139 |     await expect(page.locator('[role="dialog"]')).not.toBeVisible();
  140 |
  141 |     // Open note editor
  142 |     const noteCard = page.locator('[data-testid="note-card"]').filter({ hasText: noteTitle });
  143 |     await noteCard.locator('[data-testid="edit-note-btn"]').click();
  144 |
  145 |     // Add content to the editor
  146 |     const testContent = '# Test Header\n\nThis is **bold** text and this is *italic* text.\n\n- List item 1\n- List item 2\n\n```javascript\nconsole.log("Hello World");\n```';
  147 |
```